<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="custom.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<!-- <script src="https://sdk.amazonaws.com/js/aws-sdk-2.206.0.min.js"></script> -->
	 <script src="amazon-cognito-identity.min.js"></script>
	 <script src="aws-sdk-2.206.0.min.js"></script>
	<!-- <script src="http://requirejs.org/docs/release/2.2.0/minified/require.js"></script> -->
	<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

</head>
<body background="chatbot.jpg">

<div class="logoutButton">
	<button type="button" onclick="location.href = 'https://youtube.com';"> Sign Out </button>
</div>

<div class="main-section">
	<div class="row border-chat">
		<div class="col-md-12 col-sm-12 col-xs-12 first-section">
			<div class="row">
				<div class="col-md-8 col-sm-6 col-xs-6 left-first-section">
					<p>Chat</p>
				</div>
				<div class="col-md-4 col-sm-6 col-xs-6 right-first-section">
					<a href="#"><i class="fa fa-minus" aria-hidden="true"></i></a>
					<a href="#"><i class="fa fa-clone" aria-hidden="true"></i></a>
					<a href="#"><i class="fa fa-times" aria-hidden="true"></i></a>
				</div>
			</div>
		</div>
	</div>
	<div class="row border-chat">
		<div class="col-md-12 col-sm-12 col-xs-12 second-section">
			<div class="chat-section">
				<ul id = "chatlist">

				</ul>
			</div>
		</div>
	</div>
	<div class="row border-chat">
		<div class="col-md-12 col-sm-12 col-xs-12 third-section">
			<div class="text-bar">
				<input type="text" placeholder="Write messege" id = "usermessage"><a href="#"><i class="fa fa-arrow-right" aria-hidden="true" onclick = "updateList()"></i></a>
			</div>
		</div>
	</div>
</div>


<script type="text/javascript">

	var str = window.location.href;
	var index = str.indexOf("code=");
	if(index==-1){
		window.location.replace("https://testappdomiansmg727.auth.us-east-2.amazoncognito.com/login?response_type=code&client_id=1dds53asoh6nkrnivi8bedhn8f&redirect_uri=https://s3.us-east-2.amazonaws.com/awscloudsmg/index.html");
	}
	
	$(document).ready(function(){
    	$(".left-first-section").click(function(){
            $('.main-section').toggleClass("open-more");
        });
    });
    $(document).ready(function(){
    	$(".fa-minus").click(function(){
            $('.main-section').toggleClass("open-more");
        });
    });



//  function userLogout(){
//  	var data = {
// 		UserPoolId : 'us-east-2_PwOeQJTSG',
// 		ClientId : '67l9udsr374o5lrbskghc2v9q9'
// 	};

// 	var userPool = new AmazonCognitoIdentity.CognitoUserPool(data);
// 	console.log(userPool);
// 	var cognitoUser = userPool.getCurrentUser();
// 	console.log(cognitoUser);
// 	if (cognitoUser != null) {
// 		  cognitoUser.getSession(function(err, result) {
// 		  	if (result) {
// 				cosole.log("inside IF");
//           		cognitoUser.signOut();
//         	}
//         });
// 	}
// }

 function updateList() {
	 var string = document.getElementById("usermessage").value;
	 console.log(string);
	 var ul = document.getElementById("chatlist");
	 var li = document.createElement("li");
	 var div = document.createElement("div");
	 var img = document.createElement("img");
	 var p = document.createElement("p");
	 div.className = "right-chat";
	 img.src = "image/1499345471_boy.png";
	 p.innerHTML=string;
	 div.appendChild(img);
	 div.appendChild(p);
	 li.appendChild(div);
	 ul.appendChild(li);
	 console.log(window.location.href);
	 document.getElementById("usermessage").value = "";

	 getResponse(string);
 }


function getResponse(string){

	var reqbody = {
  	"messages": [
    {
      "type": "string",
      "unstructured": {
        "id": "one",
        "text": string,
        "timestamp": "timestamp"
      }
    }
  ]
	}

	$.ajax({
      url: `https://30jy0vcmea.execute-api.us-east-2.amazonaws.com/betaChatBot/chatbot`,
      type: 'POST',
      headers: {
      	'Content-Type': 'application/json'
      },
      data: JSON.stringify(reqbody),
      dataType: 'json',
      success: function(response) {
      	console.log(response);
      	var reply =  response.body.messages[0].unstructured.text;
        updateIncomingMessage(reply);
      },
      error: function() {
        var reply = "Error processing request";
        updateIncomingMessage(reply);
      }
    });

}


function updateIncomingMessage(string){

	 console.log(string);
	 var ul = document.getElementById("chatlist");
	 var li = document.createElement("li");
	 var div = document.createElement("div");
	 var img = document.createElement("img");
	 var p = document.createElement("p");
	 div.className = "left-chat";
	 img.src = "image/1499345471_boy.png";
	 p.innerHTML=string;
	 div.appendChild(img);
	 div.appendChild(p);
	 li.appendChild(div);
	 ul.appendChild(li);
	 document.getElementById("usermessage").value = "";



}

</script>
</body>
</html>
